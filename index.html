<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai ChatBot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #061613;
        }

        /* Moving Background Gradient */
        .gradient-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 50% 50%, #064e3b, #000000);
            z-index: -2;
        }

        /* Animated Blobs */
        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.6;
            animation: move 10s infinite alternate;
        }
        .blob-1 { top: 10%; left: 20%; width: 300px; height: 300px; background: #059669; animation-duration: 12s; } /* Emerald */
        .blob-2 { bottom: 20%; right: 10%; width: 400px; height: 400px; background: #0891b2; animation-duration: 8s; }  /* Teal */
        .blob-3 { bottom: 10%; left: 10%; width: 250px; height: 250px; background: #10b981; animation-duration: 15s; } /* Green */

        @keyframes move {
            from { transform: translate(0, 0) scale(1); }
            to { transform: translate(30px, -30px) scale(1.1); }
        }

        /* Glassmorphism Scrollbar */
        .glass-scroll::-webkit-scrollbar { width: 6px; }
        .glass-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .glass-scroll::-webkit-scrollbar-track { background: transparent; }

        /* Message Animation */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.9) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        /* Markdown Styling */
        .prose pre {
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        .prose code {
            font-family: monospace;
            background: rgba(255,255,255,0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 text-white">

    <div class="gradient-bg"></div>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <div class="w-full max-w-3xl h-[85vh] flex flex-col rounded-3xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-2xl relative overflow-hidden">
        
        <div class="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg transform hover:rotate-12 transition-transform duration-300">
                    âœ¨
                </div>
                <div>
                    <h1 class="text-xl font-semibold tracking-wide">Creative Muse</h1>
                    <p class="text-xs text-emerald-200 opacity-80">Design â€¢ Code â€¢ Write</p>
                </div>
            </div>
            <div id="status-dot" class="flex items-center gap-2 text-[10px] uppercase tracking-widest text-white/40">
                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                Online
            </div>
        </div>

        <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-6 glass-scroll">
            <!-- Welcome Message -->
            <div class="flex gap-4 pop-in">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 flex-shrink-0 flex items-center justify-center text-xs">AI</div>
                <div class="bg-white/10 border border-white/5 p-4 rounded-2xl rounded-tl-none text-sm font-light leading-relaxed backdrop-blur-md max-w-[85%]">
                    <p>Hello! I'm your creative partner. ðŸŽ¨ <br>Whether you need code, poetry, or wild ideas, I'm here to help spark your imagination. What are we creating today?</p>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden px-8 py-4">
            <div class="flex gap-2 items-center text-xs text-white/50">
                <div class="flex gap-1">
                    <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce"></span>
                    <span class="w-1.5 h-1.5 bg-teal-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                    <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                </div>
                <span>Muse is thinking...</span>
            </div>
        </div>

        <div class="p-4 bg-black/20 backdrop-blur-md border-t border-white/10">
            <form id="chat-form" class="relative">
                <input type="text" id="user-input" placeholder="Type something magical..." 
                    class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-6 pr-14 text-white placeholder-white/30 focus:outline-none focus:bg-white/10 focus:border-emerald-500/50 transition-all shadow-inner" autocomplete="off">
                
                <button type="submit" 
                    class="absolute right-2 top-2 bottom-2 w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center hover:scale-105 active:scale-95 transition-transform shadow-lg group">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white group-hover:rotate-45 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        // Using the API Key provided by user
        const apiKey = "AIzaSyA9ovnw6A5Z7CUn4_hYBBzlRn5V9s454kU"; 
        const modelId = "gemini-2.5-flash-preview-09-2025";
        const systemPrompt = "You are a creative, imaginative, and helpful AI Muse. You use emojis ðŸŒŸ occasionally. You are concise but stylish in your writing. If asked for code, you provide it cleanly formatted in markdown. Be inspiring and professional.";

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const loadingDiv = document.getElementById('loading');
        
        let history = [];

        // UI Helpers
        function scrollToBottom() {
            setTimeout(() => {
                chatContainer.scrollTo({
                    top: chatContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }, 50);
        }

        function appendMessage(role, text) {
            const isUser = role === 'user';
            const div = document.createElement('div');
            div.className = `flex gap-4 pop-in ${isUser ? 'flex-row-reverse' : ''}`;

            // Avatar
            const avatar = document.createElement('div');
            avatar.className = `w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center text-[10px] font-bold shadow-lg ${isUser ? 'bg-white text-black' : 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white'}`;
            avatar.innerText = isUser ? 'YOU' : 'AI';

            // Bubble
            const bubble = document.createElement('div');
            const bubbleStyle = isUser 
                ? "bg-gradient-to-br from-emerald-700 to-teal-800 text-white border-transparent" 
                : "bg-white/10 border-white/5 text-gray-100 prose prose-invert max-w-none";
            
            bubble.className = `${bubbleStyle} border p-4 rounded-2xl ${isUser ? 'rounded-tr-none' : 'rounded-tl-none'} backdrop-blur-md text-sm leading-relaxed shadow-lg max-w-[85%]`;

            if (!isUser && typeof marked !== 'undefined') {
                bubble.innerHTML = marked.parse(text);
            } else {
                bubble.textContent = text;
            }

            div.appendChild(avatar);
            div.appendChild(bubble);
            chatContainer.appendChild(div);
            scrollToBottom();
        }

        async function callGemini(userText) {
            // Exponential backoff retry logic
            const maxRetries = 5;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [...history, { role: "user", parts: [{ text: userText }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (err) {
                    if (i === maxRetries - 1) throw err;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        document.getElementById('chat-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            // Update UI
            appendMessage('user', text);
            userInput.value = '';
            loadingDiv.classList.remove('hidden');
            scrollToBottom();

            try {
                const aiResponse = await callGemini(text);
                
                if (aiResponse) {
                    // Update History
                    history.push({ role: "user", parts: [{ text }] });
                    history.push({ role: "model", parts: [{ text: aiResponse }] });
                    
                    // Limit history to keep performance snappy
                    if (history.length > 20) history = history.slice(-20);
                    
                    appendMessage('model', aiResponse);
                } else {
                    throw new Error("No response content");
                }
            } catch (err) {
                console.error(err);
                appendMessage('model', "I'm having trouble connecting to the stars right now. Please try again in a moment! âœ¨");
            } finally {
                loadingDiv.classList.add('hidden');
            }
        });

        // Initialize focus
        window.onload = () => userInput.focus();
    </script>
</body>
</html>